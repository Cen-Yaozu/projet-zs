<view class="container"><view class="header"><view data-event-opts="{{[['tap',[['navBack',['$event']]]]]}}" class="back-button" bindtap="__e"><text class="iconfont icon-left"></text></view><text class="title">{{isEdit?'编辑公告':'新增公告'}}</text><block wx:if="{{form.title&&form.content}}"><view data-event-opts="{{[['tap',[['previewAnnounce',['$event']]]]]}}" class="preview-button" bindtap="__e"><text class="iconfont icon-eye"></text></view></block></view><view class="content"><view class="form-container"><view class="form-section"><view class="form-item"><text class="label">标题<text class="required">*</text></text><input class="input" type="text" placeholder="请输入公告标题" data-event-opts="{{[['input',[['__set_model',['$0','title','$event',[]],['form']]]]]}}" value="{{form.title}}" bindinput="__e"/></view><view class="form-item"><text class="label">封面图<text class="tip">(建议上传16:9宽图)</text></text><block wx:if="{{!form.coverImage}}"><view data-event-opts="{{[['tap',[['handleUploadImage',['$event']]]]]}}" class="upload-area" bindtap="__e"><text class="iconfont icon-image"></text><text class="upload-text">点击上传封面图片</text></view></block><block wx:else><view class="image-preview"><image class="preview-image" src="{{form.coverImage}}" mode="aspectFill"></image><view class="image-actions"><view data-event-opts="{{[['tap',[['handleUploadImage',['$event']]]]]}}" class="action-icon" bindtap="__e"><text class="iconfont icon-edit"></text></view><view data-event-opts="{{[['tap',[['removeCoverImage',['$event']]]]]}}" class="action-icon" bindtap="__e"><text class="iconfont icon-delete"></text></view></view></view></block></view><view class="form-item"><text class="label">内容<text class="required">*</text></text><textarea class="textarea" placeholder="请输入公告内容" maxlength="2000" data-event-opts="{{[['input',[['__set_model',['$0','content','$event',[]],['form']]]]]}}" value="{{form.content}}" bindinput="__e"></textarea><text class="word-count">{{$root.g0+"/2000"}}</text></view><view class="form-item"><text class="label">类型<text class="required">*</text></text><picker range="{{typeOptions}}" value="{{typeIndex}}" data-event-opts="{{[['change',[['handleTypeChange',['$event']]]]]}}" bindchange="__e"><view class="picker-value">{{''+typeOptions[typeIndex]+''}}<text class="iconfont icon-down"></text></view></picker></view><view class="form-item"><text class="label">类别</text><view class="category-selector"><view data-event-opts="{{[['tap',[['e0',['$event']]]]]}}" class="{{['category-option',(form.category==='GENERAL_NOTICE')?'active':'']}}" bindtap="__e">招生公告</view><view data-event-opts="{{[['tap',[['e1',['$event']]]]]}}" class="{{['category-option',(form.category==='ADMISSION_RULES')?'active':'']}}" bindtap="__e">招生章程</view><view data-event-opts="{{[['tap',[['e2',['$event']]]]]}}" class="{{['category-option',(form.category==='ADMISSION_POLICY')?'active':'']}}" bindtap="__e">招生政策</view><view data-event-opts="{{[['tap',[['e3',['$event']]]]]}}" class="{{['category-option',(form.category==='HISTORICAL_REFERENCE')?'active':'']}}" bindtap="__e">往年参考</view></view></view><block wx:if="{{isEdit}}"><view class="form-item"><text class="label">状态</text><view class="status-selector"><view data-event-opts="{{[['tap',[['e4',['$event']]]]]}}" class="{{['status-option',(form.status===false)?'active':'']}}" bindtap="__e">草稿</view><view data-event-opts="{{[['tap',[['e5',['$event']]]]]}}" class="{{['status-option',(form.status===true)?'active':'']}}" bindtap="__e">已发布</view></view></view></block></view></view><view class="action-buttons"><button data-event-opts="{{[['tap',[['navBack',['$event']]]]]}}" class="cancel-btn" bindtap="__e">取消</button><button data-event-opts="{{[['tap',[['handleSubmit',['$event']]]]]}}" class="submit-btn" bindtap="__e">保存</button></view></view><uni-popup class="vue-ref" vue-id="75c4fe7d-1" type="center" data-ref="previewPopup" bind:__l="__l" vue-slots="{{['default']}}"><view class="preview-popup"><view class="preview-header"><text class="preview-title">预览公告</text><text data-event-opts="{{[['tap',[['e6',['$event']]]]]}}" class="preview-close" bindtap="__e">×</text></view><scroll-view class="preview-content" scroll-y="{{true}}"><view class="preview-article"><text class="article-title">{{form.title}}</text><view class="article-meta"><text class="article-type">{{typeOptions[typeIndex]}}</text><text class="article-date">{{currentDate}}</text></view><block wx:if="{{form.coverImage}}"><image class="article-cover" src="{{form.coverImage}}" mode="widthFix"></image></block><view class="article-body">{{form.content}}</view></view></scroll-view></view></uni-popup><block wx:if="{{loading}}"><view class="loading-overlay"><view class="loading-content"><text class="loading-text">加载中...</text></view></view></block></view>